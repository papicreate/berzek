name: Build Emscripten Project

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    # Paso crucial para permitir los comandos add-path y set-env deprecados
    - name: Allow unsecure commands for EMSDK setup
      run: echo "ACTIONS_ALLOW_UNSECURE_COMMANDS=true" >> $GITHUB_ENV
      shell: bash

    - name: Install and activate EMSDK
      run: |
        # Clonar el repositorio de emsdk
        git clone https://github.com/emscripten-core/emsdk.git emsdk
        cd emsdk
        
        # Instalar y activar la última versión (esto usa los comandos inseguros internamente)
        ./emsdk install latest
        ./emsdk activate latest
        
        # Cargar las variables de entorno en la shell actual del paso.
        # Gracias a la línea anterior (ACTIONS_ALLOW_UNSECURE_COMMANDS=true), esto funcionará.
        source "./emsdk_env.sh"
        
        # Volver al directorio raíz del proyecto para pasos posteriores
        cd ..

    - name: Verify Emscripten installation and run build command
      run: |
        # Verificar que emcc esté disponible en el PATH y mostrar la versión
        emcc --version

        # A partir de aquí, puedes añadir tus comandos de construcción, por ejemplo:
        # make all
        # ./build.sh
